<%- include("../../views/partials/user/headershopdetails") %>
    <section class="shop-details">
        <div id="product-details" data-product-id="<%= product._id %>" style="display: none;"></div>
        <div class="product__details__pic" style="background-color: #e2e0c8;">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="product__details__breadcrumb">
                            <a href="/">Home</a>
                            <a href="/shop">Shop</a>
                            <span>Product Details</span>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-3 col-md-3">
                        <ul class="nav nav-tabs" role="tablist">
                            <% product.productImage.forEach((img, index)=> { %>
                                <li class="nav-item">
                                    <a class="nav-link <%= index === 0 ? 'active' : '' %>" data-toggle="tab"
                                        href="#tabs-<%= index + 1 %>" role="tab">
                                        <div class="product__thumb__pic set-bg"
                                            data-setbg="/uploads/product-image/<%= img %>" style=" border-radius: 10px">
                                        </div>
                                    </a>
                                </li>
                                <% }) %>
                        </ul>
                    </div>
                    <div class="col-lg-6 col-md-9">
                        <div class="tab-content">
                            <% product.productImage.forEach((img, index)=> { %>
                                <div class="tab-pane <%= index === 0 ? 'active' : '' %>" id="tabs-<%= index + 1 %>"
                                    role="tabpanel">
                                    <div class="product__details__pic__item img-magnifier-container">
                                        <img id="myimage-<%= index %>" src="/uploads/product-image/<%= img %>"
                                            alt="<%= product.productName %>" class="zoomable-image"
                                            style="    border-radius: 14px">
                                    </div>
                                </div>
                                <% }) %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="product__details__content">
            <div class="container">
                <div class="row d-flex justify-content-center">
                    <div class="col-lg-8">
                        <div class="product__details__text">
                            <h4>
                                <%= product.productName %>
                            </h4>
                            <p>
                                <strong>
                                    <%= product.brand %>
                                </strong><br>
                                
                               
                            </p>

                            <div class="rating">
                                <% for (let i=0; i < 5; i++) { %>
                                    <i class="fa <%= i < product.rating ? 'fa-star' : 'fa-star-o' %>"></i>
                                    <% } %>
                                        <span> - <%= product.reviewsCount %> Reviews</span>
                            </div>
                        <% if (product.discountPercentage> 0) { %>
                            <h6 style="color: red;"><b><%= product.discountPercentage %>% off</b></h6>
                            <% } else { %>
                                <h6><b>NO DISCOUNT</b></p>
                                <% } %>
                            <h3>₹<%= product.salePrice.toFixed(2) %><span>₹<%= product.regularPrice.toFixed(2) %></span>
                            </h3>
                            <h2></h2>
                            <p>
                                <%= product.description %>
                            </p>

                            <!-- Stock Display -->
                            <div id="stock-display" style="color:gray;">Please select both size and color to see stock
                            </div>

                            <div class="product__details__option">
                                <!-- Size Selection -->
                                <div class="product__details__option">
                                    <!-- Size Selection -->
                                    <div class="product__details__option__size">
                                        <span>Size:</span>
                                        <% let uniqueSizes=[]; product.variants.forEach(function(variant) { if
                                            (!uniqueSizes.includes(variant.size)) { uniqueSizes.push(variant.size); }
                                            }); let index=0; %>
                                            <% uniqueSizes.forEach(function(size) { %>
                                                <label for="size-<%= index %>" class="size-label">
                                                    <%= size %>
                                                        <input type="radio" id="size-<%= index %>" name="size"
                                                            value="<%= size %>" data-index="<%= index %>"
                                                            onclick="updateStockDisplay()" <% let
                                                            hasAvailableColor=product.variants.some(variant=> {
                                                        return variant.size === size && variant.quantity > 0;
                                                        });
                                                        if (!hasAvailableColor) { %> <% } %>>
                                                </label>
                                                <% index++; %>
                                                    <% }); %>
                                    </div>

                                    <!-- Color Selection -->
                                    <div class="product__details__option__color">
                                        <span>Color:</span>
                                        <div class="color-options-container">
                                            <% product.variants.forEach(function(variant, index) { %>
                                                <label class="color-label" for="color-<%= index %>"
                                                    data-size="<%= variant.size %>">
                                                    <input type="radio" id="color-<%= index %>" name="color"
                                                        value="<%= variant.color %>" data-size="<%= variant.size %>"
                                                        data-quantity="<%= variant.quantity %>"
                                                        onclick="updateStockDisplay()">
                                                    <% if (["No color", "Multi" ].includes(variant.color)) { %>
                                                        <span class="color-name"
                                                            style="font-weight: 600; top: -15px; padding: 3px; font-size: 18px;
                                                                                         background: linear-gradient(to right, #f32170, #ff6b08, #cf23cf, #eedd44);
                                                                                         -webkit-text-fill-color: transparent;
                                                                                         -webkit-background-clip: text;">
                                                            <%= variant.color %>
                                                        </span>
                                                        <% } else { %>
                                                            <span class="color-swatch"
                                                                style="background-color: <%= variant.color %>; border:1px solid black;"></span>
                                                            <% } %>
                                                </label>
                                                <% }); %>
                                        </div>
                                    </div>
                                </div>

                                <!-- Add to Cart Button -->
                            </div>

                            <div class="product__details__cart__option">
                                <span>Default Quantity : </span>
                                <div class="quantity">
                                    <div class="pro-qty">
                                       
                                        <input type="number" value="1" min="1" max="6" id="quantityInput" readonly>
                          
                                    </div>
                                </div>
                                <a href="#" class="primary-btn" id="addToCartBtn" disabled>Add to Cart</a>
                            </div>
                    <div class="product__details__btns__option">
                        <a href="#" onclick="addToWishlist('<%= product._id %>')"><i class="fa fa-heart"></i> Add to Wishlist</a>
                    </div>
                            <div class="product__details__last__option">
                                <h5><span>Guaranteed Safe Checkout</span></h5>
                                <img src="/assets/usershop/img/shop-details/details-payment.png" alt="">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Related Section Begin -->
    <section class="related spad">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <h3 class="related-title">Related Products</h3>
                </div>
            </div>
            <div class="row">
                <% relatedProducts.forEach(product=> { %>
                    <div class="col-lg-3 col-md-6 col-sm-6">
                        <div class="product__item <%= product.isBlocked ? 'blocked' : '' %>"
                            onclick="window.location.href='/product/<%= product._id %>'">
                            <div class="product__item__pic set-bg"
                                data-setbg="/uploads/product-image/<%= product.productImage[0] %>"
                                data-hoverbg="/uploads/product-image/<%= product.productImage[1] %>">
                              
                            </div>
                            <div class="product__item__text">
                                <h6>
                                    <%= product.productName %>
                                </h6>

                              
                                <div class="rating">
                                    <% for (let i=0; i < 5; i++) { %>
                                        <i class="fa <%= i < product.rating ? 'fa-star' : 'fa-star-o' %>"></i>
                                        <% } %>
                                </div>
                                <h5>₹<%= product.salePrice.toFixed(2) %>
                                </h5>
                                </h5>
                                <% if (product) { %>
                                    <h1>
                                        <%= product.name %>
                                    </h1>
                                    <div>
                                        <img src="<%= product.image %>" alt="<%= product.name %>">
                                    </div>
                                    <div>

                                        <div class="product__color__select" >
                                            <% const uniqueColors=[...new Set(product.variants.map(variant=>
                                                variant.color))];
                                                %>
                                                <% if (uniqueColors.length> 0) { %>
                                                    <% uniqueColors.forEach(color=> { %>
                                                        <label for="pc-<%= color %>" style="padding-right: 15px;
                                                    margin-left: 5px;">
                                                            <input type="radio" name="color" 
                                                                value="<%= color %>">
                                                            <% if (color==="Multi" ) { %>
                                                                <span style="
                                                            font-weight: 500;
                                                            top: 0px;
                                                            padding: 0px -2px; /* Padding left and right */
                                                            font-size: 18px;
                                                            position: relative; /* Add positioning */
                                                            background: linear-gradient(to right, #f32170, #ff6b08, #cf23cf, #eedd44);
                                                            -webkit-text-fill-color: transparent;
                                                            -webkit-background-clip: text;
                                                            right: 30px; /* Now this works */
                                                        ">
                                                                    Multi
                                                                </span>

                                                                <% } else { %>
                                                                    <span
                                                                        style="background-color: <%= color %>; border-radius: 50%; width: 20px; height: 20px; display: inline-block; border: 1px solid black;right:90px"></span>
                                                                    <% } %>
                                                        </label>
                                                        <% }); %>
                                                            <% } else { %>
                                                                <p>No colors available</p>
                                                                <% } %>
                                        </div>
                                    </div>
                                    <% } else { %>
                                        <p>Product not found.</p>
                                        <% } %>
                            </div>
                        </div>
                    </div>
                    <% }) %>
            </div>
        </div>
    </section>

    <%- include("../../views/partials/user/footershopdetails") %>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="/js/cartNav.js"></script>
        <script src="/js/userBlockCheck.js"></script>
        <script src="/js/addToWishList2.js"></script>
        <script src="/js/productSelection.js"></script>
