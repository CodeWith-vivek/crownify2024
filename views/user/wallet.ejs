<%- include("../../views/partials/user/headerwallet") %>
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="wallet-card">
                <div class="wallet-header">
                    <h2><i class="fas fa-wallet me-2" style="color:white;"></i>My Wallet</h2>
                </div>
                <div class="wallet-body">
                    <div class="text-center mb-4">
                        <p class="mb-1">Current Balance</p>
                        <!-- Display the wallet balance directly -->
                        <h3 class="balance">₹<%= user.wallet.toFixed(2) || "0.00" %>
                        </h3>
                    </div>
                    <form id="add-money-form">
                        <div class="mb-3">
                            <label for="amount" class="form-label">Add Amount</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-rupee-sign"></i></span>
                                <input type="number" class="form-control" id="amount" name="amount" min="0"
                                    placeholder="Enter amount" />
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary btn-add w-100">
                            <i class="fas fa-plus-circle me-2"></i>Add to Wallet
                        </button>
                    </form>
                    <div class="mt-4">
                        <h5 class="mb-3">Quick Add</h5>
                        <div class="d-flex justify-content-between">
                            <button class="btn btn-outline-primary" onclick="quickAdd(10)">₹10</button>
                            <button class="btn btn-outline-primary" onclick="quickAdd(50)">₹50</button>
                            <button class="btn btn-outline-primary" onclick="quickAdd(100)">₹100</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<%- include("../../views/partials/user/footershop") %>


<!-- SweetAlert JS -->

<script>
  document.getElementById('add-money-form').addEventListener('submit', async (e) => {
        e.preventDefault();

        const amount = document.getElementById('amount').value;
        console.log("Amount to add:", amount); // Debug log

        if (amount <= 0) {
            swal.fire("Error", "Please enter a valid amount.", "error");
            return;
        }

        try {
            const response = await fetch('/wallet/add-money', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ amount }),
            });

            const data = await response.json();
            console.log("Response from server:", data); // Debug log

            if (data.success) {
               swal.fire({
                    title: "Success",
                    text: data.message,
                    icon: "success",
                }).then(() => {
                   location.reload(); // Perform actions after the modal is dismissed
               });
               
            } else {
                swal.fire({
                    title: "Error",
                    text: data.message,
                    icon: "error",
                });
            }
        } catch (error) {
            console.error('Error:', error);
            swal.fire({
                title: "Error",
                text: "An error occurred. Please try again.",
                icon: "error",
            });
        }
    });

    window.addEventListener('DOMContentLoaded', async () => {
        try {
            const response = await fetch('/wallet/balance');
            const data = await response.json();

            console.log("Balance response:", data); // Debug log

            if (data.success) {
                document.querySelector('.balance').textContent = `₹${data.balance.toFixed(2)}`;
            } else {
                swal.fire("Error", data.message, "error");
            }
        } catch (error) {
            console.error('Error fetching balance:', error);
            swal.fire("Error", "An error occurred while fetching the balance.", "error");
        }
    });
    function quickAdd(amount) {
        const amountInput = document.getElementById("amount");
        amountInput.value = amount; // Set the amount
        console.log("Quick add amount set to:", amount); // Debug log

        // Submit the form programmatically
        document.getElementById("add-money-form").dispatchEvent(new Event('submit', { bubbles: true, cancelable: true }));
    }
</script>