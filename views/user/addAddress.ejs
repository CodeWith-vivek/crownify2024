<%- include("../../views/partials/user/headerAddress") %>
    <section class="breadcrumb-option">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb__text">

                        <div class="breadcrumb__links">
                            <a href="/" style="color: white;">Home</a> <span
                                style="padding-right: 10px; font-size: small; padding-left: 10px;"> ></span>
                            <a href="#" style="color:rgb(108, 108, 108) ;">Pages</a><span
                                style="padding-right: 10px; font-size: small; padding-left: 10px;"> ></span>
                            <a href="/profile" style="color:rgb(108, 108, 108) ;">Account</a> <span
                                style="padding-right: 10px; font-size: small; padding-left: 10px;"> ></span>
                            <a href="/user/addAddress" style="color: rgb(109, 109, 109);">Add New Address</a>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="ftco-section">

        <div class="container">

            <div class="row justify-content-center">
                <div class="col-lg-12">
                    <div class="wrap d-md-flex">
                        <div class="text-wrap p-4 p-lg-5 d-flex img d-flex align-items-end"
                            style="background-image: url(/assets/images/Address.webp);">
                            <div class="text w-100">
                                <h2 class="mb-4">Welcome to Login page</h2>
                                <p>Far far away, behind the word mountains, far from the countries Vokalia and
                                    Consonantia,
                                    there live the blind texts.</p>
                            </div>
                        </div>

                        <div class="login-wrap p-4 p-md-5"
                            style="background-image: url(/assets/images/addressDesign.png); background-size: cover; background-position: center; background-repeat: no-repeat;">
                            <h3 class="mb-3" style="font-weight: 600;">Add New Address</h3>
                            <!-- <% if (messages.error) { %>
                                <div style="color: red;">
                                    <%= messages.error %>
                                </div>
                                <% } %> -->


                            <form method="post" action="/addAddress" class="signup-form" id="signform">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="addressType">Address Type:</label>
                                            <select name="addressType" id="addressType" required
                                                style="border-radius: 36px;">
                                                <option value="">Select Address Type</option>
                                                <option value="Home">Home</option>
                                                <option value="Office">Office</option>
                                                <option value="Other">Other</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label class="label" style="width: 300px;" for="name">Full Name ( First and
                                                Last Name )</label>
                                            <input type="text" class="form-control" name="name" id="name"
                                                placeholder="Enter name">
                                            <div id="error1" class="error-message"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="label" for="country">Country / Region</label>
                                            <input type="text" class="form-control" name="country" id="country"
                                                placeholder="Enter your country">
                                            <div id="error2" class="error-message"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="label" for="phone">Mobile Number</label>
                                            <input type="text" class="form-control" name="phone" id="phone"
                                                placeholder="Enter phone number">
                                            <div id="error3" class="error-message"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label class="label" for="pincode">Pincode / Zipcode</label>
                                            <input type="text" class="form-control" name="pincode" id="pincode"
                                                placeholder="Enter pincode">
                                            <div id="error4" class="error-message"></div>
                                        </div>
                                    </div>

                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label class="label" style="width: 300px;" for="home">Flat, House
                                                no.,Company</label>
                                            <div class="input-group">
                                                <input type="text" id="home" class="form-control" name="home"
                                                    placeholder="Enter flat / house no">


                                            </div>


                                            <div id="error5" class="error-message"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label class="label" for="area">Area, Street</label>
                                            <div class="input-group">
                                                <input type="text" id="area" class="form-control" name="area"
                                                    placeholder="Enter area / street ">

                                            </div>


                                            <div id="error6" class="error-message"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label class="label" for="landmark">Landmark</label>
                                            <div class="input-group">
                                                <input type="text" id="landmark" class="form-control" name="landmark"
                                                    placeholder="Enter landmark">

                                            </div>


                                            <div id="error7" class="error-message"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="label" for="town">Town / City</label>
                                            <div class="input-group">
                                                <input type="text" id="town" class="form-control" name="town"
                                                    placeholder="Enter city / town ">

                                            </div>


                                            <div id="error8" class="error-message"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="label" for="state">State /Province</label>
                                            <div class="input-group">
                                                <input type="state" id="state" class="form-control" name="state"
                                                    placeholder="Enter state or province">

                                            </div>


                                            <div id="error9" class="error-message"></div>
                                        </div>
                                    </div>


                                    <div class="col-md-12 text-center">
                                        <div class="form-group ">
                                            <button type="submit" class="btn btn-secondary submit "
                                                style="width:170px">Add Address</button>
                                        </div>
                                    </div>
                                </div>

                            </form>

                        </div>

                    </div>
                </div>
            </div>
        </div>
    </section>
    <%- include("../../views/partials/user/footerAddress") %>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script>
            const nameid = document.getElementById("name");
            const countryid = document.getElementById("country")
            const phoneid = document.getElementById("phone")
            const pincode = document.getElementById("pincode")
            const homeid = document.getElementById("home")
            const areaid = document.getElementById("area")
            const landmarkid = document.getElementById("landmark")
            const townid = document.getElementById("town")
            const stateid = document.getElementById("state")
            const addressTypeSelect = document.getElementById("addressType");
            let nameValid = false;
            let countryValid = false;
            let phoneValid = false;
            let pincodeValid = false;
            let homeValid = false;
            let areaValid = false;
            let landmarkValid = false;
            let townValid = false;
            let stateValid = false;
            let addressTypeValid = false;

            addressTypeSelect.addEventListener('change', () => {
                if (addressTypeSelect.value === "") {
                    addressTypeValid = false;
                } else {
                    addressTypeValid = true;
                }
            });

          
            nameid.addEventListener('input', () => {
                const nameValue = nameid.value.trim();
                const namePattern = /^[A-Za-z]+(?: [A-Za-z]+){1,2}$/;
                if (nameValue === "") {
                    error1.style.display = "block";
                    error1.innerHTML = "Please enter a valid name";
                    nameValid = false;
                } else if (!namePattern.test(nameValue)) {
                    error1.style.display = "block";
                    error1.innerHTML = "Full name required";
                    nameValid = false;
                } else {
                    error1.style.display = "none";
                    error1.innerHTML = "";
                    nameValid = true;
                }
            });

         
            countryid.addEventListener('input', () => {
                const countryValue = countryid.value.trim();
                const countryPattern = /^[A-Za-z]+$/;
                if (countryValue === "") {
                    error2.style.display = "block";
                    error2.innerHTML = "Country cannot be blank";
                    countryValid = false;
                } else if (!countryPattern.test(countryValue)) {
                    error2.style.display = "block";
                    error2.innerHTML = "Country must only contain letters";
                    countryValid = false;
                } else {
                    error2.style.display = "none";
                    countryValid = true;
                }
            });

          
            phoneid.addEventListener('input', () => {
                const phoneValue = phoneid.value.trim();
                const phonePattern = /^\d{10}$/;
                if (phoneValue === "") {
                    error3.style.display = "block";
                    error3.innerHTML = "Phone number cannot be blank";
                    phoneValid = false;
                } else if (!phonePattern.test(phoneValue)) {
                    error3.style.display = "block";
                    error3.innerHTML = "Phone number must be 10 digits";
                    phoneValid = false;
                } else {
                    error3.style.display = "none";
                    phoneValid = true;
                }
            });

         
            pincode.addEventListener('input', () => {
                const pincodeValue = pincode.value.trim();
                const pincodePattern = /^\d{6}$/;
                if (pincodeValue === "") {
                    error4.style.display = "block";
                    error4.innerHTML = "Pincode cannot be blank";
                    pincodeValid = false;
                } else if (!pincodePattern.test(pincodeValue)) {
                    error4.style.display = "block";
                    error4.innerHTML = "Pincode must be 6 digits";
                    pincodeValid = false;
                } else {
                    error4.style.display = "none";
                    pincodeValid = true;
                }
            });

          
            homeid.addEventListener('input', () => {
                const homeValue = homeid.value.trim();
                if (homeValue === "" || homeValue.split(' ').length < 2) {
                    error5.style.display = "block";
                    error5.innerHTML = "Home address cannot be blank or just a single space";
                    homeValid = false;
                } else {
                    error5.style.display = "none";
                    homeValid = true;
                }
            });

          
            areaid.addEventListener('input', () => {
                const areaValue = areaid.value.trim();
                const areaPattern = /^[A-Za-z0-9]+$/;
                if (areaValue === "") {
                    error6.style.display = "block";
                    error6.innerHTML = "Area cannot be blank";
                    areaValid = false;
                } else if (!areaPattern.test(areaValue)) {
                    error6.style.display = "block";
                    error6.innerHTML = "Area must only contain letters and numbers, no spaces";
                    areaValid = false;
                } else {
                    error6.style.display = "none";
                    areaValid = true;
                }
            });

          
            landmarkid.addEventListener('input', () => {
                const landmarkValue = landmarkid.value.trim();
                const landmarkPattern = /^[A-Za-z0-9]+$/;
                if (landmarkValue === "") {
                    error7.style.display = "block";
                    error7.innerHTML = "Landmark cannot be blank";
                    landmarkValid = false;
                } else if (!landmarkPattern.test(landmarkValue)) {
                    error7.style.display = "block";
                    error7.innerHTML = "Landmark must only contain letters and numbers, no spaces";
                    landmarkValid = false;
                } else {
                    error7.style.display = "none";
                    landmarkValid = true;
                }
            });

           
            townid.addEventListener('input', () => {
                const townValue = townid.value.trim();
                const townPattern = /^[A-Za-z]+$/;
                if (townValue === "") {
                    error8.style.display = "block";
                    error8.innerHTML = "Town cannot be blank";
                    townValid = false;
                } else if (!townPattern.test(townValue)) {
                    error8.style.display = "block";
                    error8.innerHTML = "Town must only contain letters";
                    townValid = false;
                } else {
                    error8.style.display = "none";
                    townValid = true;
                }
            });

        
            stateid.addEventListener('input', () => {
                const stateValue = stateid.value.trim();
                const statePattern = /^[A-Za-z]+$/;
                if (stateValue === "") {
                    error9.style.display = "block";
                    error9.innerHTML = "State cannot be blank";
                    stateValid = false;
                } else if (!statePattern.test(stateValue)) {
                    error9.style.display = "block";
                    error9.innerHTML = "State must only contain letters";
                    stateValid = false;
                } else {
                    error9.style.display = "none";
                    stateValid = true;
                }
            });
            document.getElementById('signform').addEventListener('submit', async (event) => {
                event.preventDefault();

            
                if (nameValid && countryValid && phoneValid && pincodeValid && homeValid && areaValid && landmarkValid && townValid && stateValid && addressTypeValid) {
                    const formData = new FormData(event.target);
                    const data = Object.fromEntries(formData.entries());

                    try {
                        const response = await fetch('/addAddress', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(data),
                        });

                        if (response.ok) {
                            const result = await response.json();
                            Swal.fire('Success', result.message, 'success').then(() => {
                               
                                window.location.href = '/Address';
                            });
                          
                        } else {
                            const error = await response.json();
                            Swal.fire('Error', error.message, 'error');
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        Swal.fire('Error', 'There was an error submitting your address.', 'error');
                    }
                } else {
                    Swal.fire('Validation Error', 'Please correct the errors in the form.', 'error');
                }
            });
        </script>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const cartLinks = document.querySelectorAll('.site-header__cart');

                cartLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        console.log('Cart link clicked');

                      
                        e.stopPropagation();

                       
                        window.location.href = '/cart';

                     
                        e.preventDefault();
                    });
                });
            });
        </script>